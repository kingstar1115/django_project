{% load i18n static %}
{% load simpletags %}
{% if cl.search_fields or cl.has_filters %}
    <script type="text/javascript">
        function preSubmit() {
            $('#changelist-search').find("input[name!='']").each(function () {
                if ($(this).val() == '') {
                    $(this).removeAttr('name');
                }
            });
        }
    </script>
    <div id="toolbar">
        <form id="changelist-search" method="get" onsubmit="preSubmit(this)">
            <input type="hidden" name="p" value=""/>
            <div class="simpleui-form"><!-- DIV needed for valid HTML -->

                {% if cl.search_fields %}

                    <el-input class="simpleui-form-item"
                              clearable
                              name="{{ search_var }}"
                              :placeholder="placeholder"
                              prefix-icon="el-icon-search"
                              v-model="searchInput" @keyup.enter.native="formSubmit()">
                    </el-input>
                {% endif %}
                {% if cl.has_filters %}

                    {% for spec in cl.filter_specs %}

                        {% if spec.links %}
                            <input type="input" class="date_field" data-name="{{ spec.field_path }}"
                                   placeholder="{{ spec.title }}"/>
                            <input type="hidden" name="{{ spec.field_generic }}gte"/>
                            <input type="hidden" name="{{ spec.field_generic }}lt"/>
                            <div>date</div>
                        {% else %}
                            <input type="hidden" v-model="{{ spec.lookup_kwarg }}" name="{{ spec.lookup_kwarg }}"/>
                            <el-select v-model="{{ spec.lookup_kwarg }}" clearable
                                       placeholder="{{ spec.title }}">
                                {% if spec.lookup_choices %}
                                    {% if spec.lookup_choices.query %}
                                        {% for option in spec.lookup_choices %}
                                            <el-option label="{{ option }}" value="{{ option }}"></el-option>
                                        {% endfor %}
                                    {% else %}
                                        {% for option in spec.lookup_choices %}
                                            <el-option label="{{ option.1 }}" value="{{ option.0 }}"></el-option>
                                        {% endfor %}
                                    {% endif %}
                                {% elif spec.field.choices %}
                                    {% for option in spec.field.choices %}
                                        <el-option label="{{ option.1 }}" value="{{ option.0 }}"></el-option>
                                    {% endfor %}
                                {% else %}
                                    <el-option label="True" value="True"></el-option>
                                    <el-option label="False" value="False"></el-option>
                                {% endif %}
                            </el-select>

                        {% endif %}

                    {% endfor %}
                {% endif %}
                <el-button type="primary" icon="el-icon-search" @click="formSubmit()">{% trans 'Search' %}</el-button>

                {% if show_result_count %}
                    <span class="small quiet">{% blocktrans count counter=cl.result_count %}{{ counter }} result{% plural %}{{ counter }} results{% endblocktrans %} (<a href="?{% if cl.is_popup %}_popup=1{% endif %}">{% if cl.show_full_result_count %}{% blocktrans with full_result_count=cl.full_result_count %}{{ full_result_count }} total{% endblocktrans %}{% else %}{% trans "Show all" %}{% endif %}</a>)</span>
                {% endif %}

                {% for pair in cl.params.items %}
                    {% if pair.0 != search_var %}
                        <input type="hidden" class="form-params" data-name="{{ pair.0 }}" value="{{ pair.1 }}"/>
                    {% endif %}
                {% endfor %}
            </div>
        </form>
    </div>
    <script type="text/javascript">
        var searchApp=new Vue({
            el: '#toolbar',
            data: {
                placeholder:'{% trans 'Search' %}',
                searchInput: '{{ cl.query }}',
                {% if cl.has_filters %}
                    {% for spec in cl.filter_specs %}
                        '{{ spec.lookup_kwarg }}': '',
                    {% endfor %}
                {% endif %}
            },
            created: function () {
                var self = this;
                $('.form-params').each(function () {
                    var key = $(this).attr('data-name');
                    var value = $(this).val();
                    self[key] = value;
                })
            },
            methods: {
                formSubmit: function () {
                    preSubmit();
                    document.getElementById('changelist-search').submit();
                }
            }
        })

    </script>
{% endif %}
